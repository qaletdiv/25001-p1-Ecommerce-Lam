<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ji-ho Shouta - Đăng nhập</title>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <!-- Form đăng nhập -->
    <form class="form" id="login">
      <h2>Đăng nhập</h2>

      <label for="username">Tên đăng nhập</label>
      <input
        id="username"
        type="text"
        name="username"
        placeholder="Tên đăng nhập"
        required
      />

      <label for="password">Mật khẩu</label>
      <input
        id="password"
        type="password"
        name="password"
        placeholder="Mật khẩu"
        required
      />

      <button type="submit">Đăng nhập</button>
      <p>Bạn chưa có tài khoản? <a href="register.html">Đăng Ký</a></p>
    </form>

    <script>
      const loginForm = document.getElementById("login");

      loginForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const usernameInput = document
          .getElementById("username")
          .value.trim()
          .toLowerCase();
        const passwordInput = document.getElementById("password").value;

        // Lấy danh sách user từ localStorage
        const users = JSON.parse(localStorage.getItem("users")) || [];

        // Tìm user khớp với username và password
        const user = users.find(
          (u) => u.username === usernameInput && u.password === passwordInput
        );

        if (user) {
          // Lưu trạng thái đăng nhập
          localStorage.setItem("currentUser", JSON.stringify(user));
          localStorage.setItem("userLoggedIn", "true");

          // Kiểm tra redirect nếu có
          const params = new URLSearchParams(window.location.search);
          const redirectTo = params.get("redirect") || "index.html";

          window.location.href = redirectTo;
        } else {
          alert("Sai tên đăng nhập hoặc mật khẩu.");
        }
      });
    </script>
  </body>
</html>
